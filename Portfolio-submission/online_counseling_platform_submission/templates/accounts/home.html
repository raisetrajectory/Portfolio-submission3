{% extends "base.html" %}
{% block content %}
{% if messages %}
    {% for message in messages %}
        <div>{{ message.message }}</div>
    {% endfor %}
{% endif %}
オンラインカウンセリングサービスへようこそ！

<h3>{{ theme.title }}</h3>
{% for comment in comments %}
<div class="col-1 offset-1">
    {% if comment.user.picture %}
        <img style="float:left;" width="50px" height="50px" src="{{ comment.user.picture.url }}">
    {% endif %}
</div>
<div class="col-8 offset-2">
    <p>名前: {{ comment.user.username }}</p>
    <p>{{ comment.comment | linebreaks }}</p>
    {% if comment.user == user %}
        <a href="{% url 'boards:comment_delete' comment.pk %}">コメント削除</a>
    {% endif %}
</div>
<div class="col-10 offset-1">
<hr>
</div>
{% endfor %}
{% if user.is_authenticated %}
<div class="col-4 offset-7">
    <form method="POST">
    {% csrf_token %}
    {{ post_comment_form.as_p }}
    {% comment %} <input type="button" value="一時保存" id="save_comment"> {% endcomment %}
    <input type="submit" value="コメント送信">
    </form>
</div>
{% endif %}
{% endblock %}
{% block javascript %}

<nav class="navbar navbar-expand-lg navbar-light bg-light flex-column align-items-end">
    <a class="btn btn-primary mb-2" href="{% url 'accounts:home' %}">メインメニューへ</a>
    <a class="btn btn-primary mb-2" href="{% url 'accounts:home' %}">相談を終了する</a>
</nav>

<script>
$("#save_comment").click(function(){
    var comment = $("#id_comment").val();
    $.ajax({
        url: "{% url 'boards:save_comment' %}",
        type: "GET",
        data: {comment: comment, theme_id: "{{ theme.id }}"},
        dataType: "json",
        success: function(json){
            if(json.message){
                alert(json.message);
            }
        }
    });
});
</script>
{% comment %} {% endblock %} {% endcomment %}

<!-- デバッグ用 -->
{% comment %} <p>インクルードの前</p>
{% include 'boards/post_comments.html' %}
<p>インクルードの後</p> {% endcomment %}

<nav class="navbar navbar-expand-lg navbar-light bg-light flex-column">
    <a class="navbar-brand" href="{% url 'accounts:home' %}">ホーム</a>
    <a class="navbar-brand" href="{% url 'boards:list_themes' %}">チャット制作画面へ</a>
    <a class="navbar-brand" href="{% url 'boards:counselor_profile' %}">プロフィール画面へ</a>
    <a class="navbar-brand" href="{% url 'boards:counselor_list' %}">カウンセラー一覧画面へ</a>
    {% if user.is_authenticated %}
        <a class="navbar-brand" href="{% url 'accounts:user_logout' %}">ログアウト</a>
        <a class="navbar-brand" href="{% url 'accounts:user_edit' %}">ユーザー情報更新画面へ</a>
    {% else %}
        <a class="navbar-brand" href="{% url 'accounts:user_login' %}">ログイン</a>
        <a class="navbar-brand" href="{% url 'accounts:regist' %}">ユーザー登録</a>
    {% endif %}
</nav>

{% endblock %}